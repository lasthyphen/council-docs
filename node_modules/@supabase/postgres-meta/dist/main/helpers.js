"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.toTransaction = exports.coalesceRowsToArray = void 0;
const coalesceRowsToArray = (source, joinQuery) => {
    // Note that array_to_json(array_agg(row_to_json())) seems to perform better than json_agg
    return `
COALESCE(
  (
    SELECT
      array_to_json(array_agg(row_to_json(${source})))
    FROM
      ( ${joinQuery} ) ${source}
  ),
  '[]'
) AS ${source}`;
};
exports.coalesceRowsToArray = coalesceRowsToArray;
/**
 * Transforms an array of SQL strings into a transaction
 */
const toTransaction = (statements) => {
    let cleansed = statements.map((x) => {
        let sql = x.trim();
        if (sql.length > 0 && x.slice(-1) !== ';')
            sql += ';';
        return sql;
    });
    const allStatements = cleansed.join('');
    return `BEGIN; ${allStatements} COMMIT;`;
};
exports.toTransaction = toTransaction;
//# sourceMappingURL=helpers.js.map